## Load library

```{r}
library(readr)
library(dplyr)
library(ggplot2)
library(survival)
library(survminer)

```

## Load dataset
```{r}
clinical_data <- read_tsv("msk_chord_2024_clinical_data (2).tsv")


```

## Data Cleaning And Pre-Processing

## Detect Missing Value
```{r}
colSums(is.na(clinical_data))
```


## Remove Rows with Critical Missing Values

```{r}
clinical_data_clean <- clinical_data %>%
  filter(
    !is.na(`Current Age`),
    !is.na(Sex),
    !is.na(`Cancer Type`),
    !is.na(`Stage (Highest Recorded)`),
    !is.na(`Overall Survival Status`)
  )
```


## Clean NLP-Derived fields

```{r}
clinical_data_clean <- clinical_data_clean %>%
  mutate(
    `Cancer Type` = trimws(tolower(`Cancer Type`)),
    `Stage (Highest Recorded)`= trimws(toupper(`Stage (Highest Recorded)`))
  )
```


## Create Treatment Response

```{r}
clinical_data_clean <- clinical_data_clean %>%
  mutate(
    survival_status_clean = tolower(trimws(`Overall Survival Status`)),
    treatment_response = ifelse(
      grepl("alive|living", survival_status_clean),
      "Good Response",
      "Poor Response"
    )
  )


```

## Data Manipulation
## Accessing Columns

```{r}
clinical_data_clean$`Current Age`
clinical_data_clean$treatment_response

```

## Subsetting

```{r}
subset(clinical_data_clean, Sex == "Female")
```

## Aggregation
```{r}
clinical_data_clean %>%
  group_by(`Stage (Highest Recorded)`, treatment_response) %>%
  summarise(count = n())
```


## Data Visualization

## Age vs Treatment Response
```{r}
ggplot(clinical_data_clean,aes(x = `Current Age`, fill = treatment_response)
       )+
  geom_histogram(position = "identity", alpha = 0.6, bins = 20)+
  labs(title = "Age vs Treatment Response")
```
## Gender vs Treatment Response
```{r}
ggplot(
  clinical_data_clean,
       aes(x = Sex, fill = treatment_response)) +
  geom_bar(position = "fill") +
  labs(title = "Treatment Response by Gender",
       y = "Proportion")

```

## Tumor Stage vs Treatment Response
```{r}
ggplot(
  clinical_data_clean,
  aes(x = `Stage (Highest Recorded)`, fill = treatment_response)
)+
  geom_bar(position = "fill")+
  labs(title = "Treatment Response by Tumor Stage")
```

## Create binary numeric response
```{r}
## Create binary treatment_response for logistic regression
clinical_data_clean <- clinical_data_clean %>%
  mutate(
    treatment_response_bin = ifelse(treatment_response == "Good Response", 1, 0)
  )

```

## Create binary numeric response
```{r}
model <- glm(
  treatment_response_bin ~ `Current Age` + Sex + `Stage (Highest Recorded)`,
  data = clinical_data_clean,
  family = binomial
)

summary(model)

```


##Pipe Operator(%>%)
```{r}
clinical_data_clean %>%
  filter(`Current Age` > 40) %>%
  select(`Current Age`, Sex, `Cancer Type`, `Stage (Highest Recorded)`, treatment_response) %>%
  mutate(age_group = ifelse(`Current Age` < 60, "Middle", "Older")) %>%
  arrange(`Stage (Highest Recorded)`)
```





